<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Mr Xie Blog</title>
    <description>å…³äºç¨‹åºä¸è®¾è®¡ã€é»‘å®¢ä¸ç”»å®¶ | é»„ç„ï¼ŒWeb &amp; Mobile Loverï¼ŒSoftware Engineerï¼ŒUX Designer | è¿™é‡Œæ˜¯ @Huxé»„ç„ çš„ä¸ªäººåšå®¢ï¼Œä¸ä½ ä¸€èµ·å‘ç°æ›´å¤§çš„ä¸–ç•Œã€‚</description>
    <link>http://localhost:4000/</link>
    <atom:link href="http://localhost:4000/feed.xml" rel="self" type="application/rss+xml" />
    <pubDate>Mon, 05 Aug 2019 23:06:54 +0800</pubDate>
    <lastBuildDate>Mon, 05 Aug 2019 23:06:54 +0800</lastBuildDate>
    <generator>Jekyll v3.8.5</generator>
    
      <item>
        <title>Golang æ˜¯å¦æœ‰å¿…è¦å†…å­˜å¯¹é½ï¼Ÿ</title>
        <description>&lt;p&gt;æœ‰äº›åŒå­¦å¯èƒ½ä¸çŸ¥é“ï¼Œstruct ä¸­çš„å­—æ®µé¡ºåºä¸åŒï¼Œå†…å­˜å ç”¨ä¹Ÿæœ‰å¯èƒ½ä¼šç›¸å·®å¾ˆå¤§ã€‚æ¯”å¦‚ï¼š&lt;/p&gt;

&lt;div class=&quot;language-go highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;T1&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int8&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int64&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int16&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;T2&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int8&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int16&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int64&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;åœ¨ 64 bit å¹³å°ä¸Šï¼ŒT1 å ç”¨ 24 bytesï¼ŒT2 å ç”¨ 16 bytes å¤§å°ï¼›è€Œåœ¨ 32 bit å¹³å°ä¸Šï¼ŒT1 å ç”¨ 16 bytesï¼ŒT2 å ç”¨ 12 bytes å¤§å°ã€‚&lt;strong&gt;å¯è§ä¸åŒçš„å­—æ®µé¡ºåºï¼Œæœ€ç»ˆå†³å®š struct çš„å†…å­˜å¤§å°ï¼Œæ‰€ä»¥æœ‰æ—¶å€™åˆç†çš„å­—æ®µé¡ºåºå¯ä»¥å‡å°‘å†…å­˜çš„å¼€é”€&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;p&gt;è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ&lt;u&gt;å› ä¸ºæœ‰å†…å­˜å¯¹é½çš„å­˜åœ¨ï¼Œç¼–è¯‘å™¨ä½¿ç”¨äº†å†…å­˜å¯¹é½ï¼Œé‚£ä¹ˆæœ€åçš„å¤§å°ç»“æœå°±ä¼šä¸ä¸€æ ·&lt;/u&gt;ã€‚è‡³äºä¸ºä»€ä¹ˆè¦åšå¯¹é½ï¼Œä¸»è¦è€ƒè™‘ä¸‹é¢ä¸¤ä¸ªåŸå› ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;å¹³å°ï¼ˆç§»æ¤æ€§ï¼‰&lt;/p&gt;

    &lt;p&gt;ä¸æ˜¯æ‰€æœ‰çš„ç¡¬ä»¶å¹³å°éƒ½èƒ½å¤Ÿè®¿é—®ä»»æ„åœ°å€ä¸Šçš„ä»»æ„æ•°æ®ã€‚ä¾‹å¦‚ï¼šç‰¹å®šçš„ç¡¬ä»¶å¹³å°åªå…è®¸åœ¨ç‰¹å®šåœ°å€è·å–ç‰¹å®šç±»å‹çš„æ•°æ®ï¼Œå¦åˆ™ä¼šå¯¼è‡´å¼‚å¸¸æƒ…å†µ&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;æ€§èƒ½&lt;/p&gt;

    &lt;p&gt;è‹¥è®¿é—®æœªå¯¹é½çš„å†…å­˜ï¼Œå°†ä¼šå¯¼è‡´ CPU è¿›è¡Œä¸¤æ¬¡å†…å­˜è®¿é—®ï¼Œå¹¶ä¸”è¦èŠ±è´¹é¢å¤–çš„æ—¶é’Ÿå‘¨æœŸæ¥å¤„ç†å¯¹é½åŠè¿ç®—ã€‚è€Œæœ¬èº«å°±å¯¹é½çš„å†…å­˜ä»…éœ€è¦ä¸€æ¬¡è®¿é—®å°±å¯ä»¥å®Œæˆè¯»å–åŠ¨ä½œï¼Œè¿™æ˜¾ç„¶é«˜æ•ˆå¾ˆå¤šï¼Œæ˜¯æ ‡å‡†çš„ç©ºé—´æ¢æ—¶é—´åšæ³•&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
  &lt;p&gt;æœ‰çš„å°ä¼™ä¼´å¯èƒ½ä¼šè®¤ä¸ºå†…å­˜è¯»å–ï¼Œå°±æ˜¯ä¸€ä¸ªç®€å•çš„å­—èŠ‚æ•°ç»„æ‘†æ”¾ã€‚ä½†å®é™…ä¸Š CPU å¹¶ä¸ä¼šä»¥ä¸€ä¸ªä¸€ä¸ªå­—èŠ‚å»è¯»å–å’Œå†™å…¥å†…å­˜ï¼Œç›¸å CPU è¯»å–å†…å­˜æ˜¯ä¸€å—ä¸€å—è¯»å–çš„ï¼Œå—çš„å¤§å°å¯ä»¥ä¸º 2ã€4ã€6ã€8ã€16 å­—èŠ‚ç­‰å¤§å°ï¼Œå—å¤§å°æˆ‘ä»¬ç§°å…¶ä¸ºå†…å­˜è®¿é—®ç²’åº¦ã€‚å‡è®¾è®¿é—®ç²’åº¦ä¸º 4ï¼Œé‚£ä¹ˆ CPU å°±ä¼šä»¥æ¯ 4 ä¸ªå­—èŠ‚å¤§å°çš„è®¿é—®ç²’åº¦å»è¯»å–å’Œå†™å…¥å†…å­˜ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;åœ¨ä¸åŒå¹³å°ä¸Šçš„ç¼–è¯‘å™¨éƒ½æœ‰è‡ªå·±é»˜è®¤çš„ â€œå¯¹é½ç³»æ•°â€ã€‚ä¸€èˆ¬æ¥è®²ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„ x86 å¹³å°çš„ç³»æ•°ä¸º 4ï¼›x86_64 å¹³å°ç³»æ•°ä¸º 8ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé™¤äº†è¿™ä¸ªé»˜è®¤çš„å¯¹é½ç³»æ•°å¤–ï¼Œè¿˜æœ‰ä¸åŒæ•°æ®ç±»å‹çš„å¯¹é½ç³»æ•°ã€‚æ•°æ®ç±»å‹çš„å¯¹é½ç³»æ•°åœ¨ä¸åŒå¹³å°ä¸Šå¯èƒ½ä¼šä¸ä¸€è‡´ã€‚ä¾‹å¦‚ï¼Œåœ¨ x86_64 å¹³å°ä¸Šï¼Œint64 çš„å¯¹é½ç³»æ•°ä¸º 8ï¼Œè€Œåœ¨ x86 å¹³å°ä¸Šå…¶å¯¹é½ç³»æ•°å°±æ˜¯ 4ã€‚&lt;/p&gt;

&lt;p&gt;è¿˜æ˜¯æ‹¿ä¸Šé¢çš„ T1ã€T2 æ¥è¯´ï¼Œåœ¨ x86_64 å¹³å°ä¸Šï¼ŒT1 çš„å†…å­˜å¸ƒå±€ä¸ºï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/in-post/memory-alignment/T1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;T2 çš„å†…å­˜å¸ƒå±€ä¸ºï¼ˆint16 çš„å¯¹é½ç³»æ•°ä¸º 2ï¼‰ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/in-post/memory-alignment/T2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä»”ç»†çœ‹ï¼ŒT1 å­˜åœ¨è®¸å¤š paddingï¼Œæ˜¾ç„¶å®ƒå æ®äº†ä¸å°‘ç©ºé—´ã€‚é‚£ä¹ˆä¹Ÿå°±ä¸éš¾ç†è§£ï¼Œä¸ºä»€ä¹ˆè°ƒæ•´ç»“æ„ä½“å†…æˆå‘˜å˜é‡çš„å­—æ®µé¡ºåºå°±èƒ½è¾¾åˆ°ç¼©å°ç»“æ„ä½“å ç”¨å¤§å°çš„ç–‘é—®äº†ï¼Œæ˜¯å› ä¸ºå·§å¦™åœ°å‡å°‘äº† padding çš„å­˜åœ¨ã€‚è®©å®ƒä»¬æ›´ â€œç´§å‡‘â€ äº†ã€‚&lt;/p&gt;

&lt;p&gt;å…¶å®å†…å­˜å¯¹é½é™¤äº†å¯ä»¥é™ä½å†…å­˜å ç”¨ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯å¿…é¡»è¦æ‰‹åŠ¨å¯¹é½çš„ï¼š&lt;strong&gt;åœ¨ x86 å¹³å°ä¸ŠåŸå­æ“ä½œ 64bit æŒ‡é’ˆã€‚ä¹‹æ‰€ä»¥è¦å¼ºåˆ¶å¯¹é½ï¼Œæ˜¯å› ä¸ºåœ¨ 32bit å¹³å°ä¸‹è¿›è¡Œ 64bit åŸå­æ“ä½œè¦æ±‚å¿…é¡» 8 å­—èŠ‚å¯¹é½ï¼Œå¦åˆ™ç¨‹åºä¼š panic&lt;/strong&gt;ã€‚è¯¦æƒ…å¯ä»¥å‚è€ƒ &lt;a href=&quot;https://godoc.org/sync/atomic#pkg-note-bug&quot;&gt;atomic&lt;/a&gt; å®˜æ–¹æ–‡æ¡£ï¼ˆè¿™ä¹ˆé‡è¦çš„ä¿¡æ¯ç«Ÿç„¶æ”¾åœ¨é¡µé¢çš„æœ€åº•éƒ¨ï¼ï¼ï¼ğŸ˜±ï¼‰ï¼š&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;Bugs&lt;/strong&gt;&lt;/p&gt;

  &lt;p&gt;On x86-32, the 64-bit functions use instructions unavailable before the Pentium MMX. On non-Linux ARM, the 64-bit functions use instructions unavailable before the ARMv6k core. On ARM, x86-32, and 32-bit MIPS, it is the callerâ€™s responsibility to arrange for 64-bit alignment of 64-bit words accessed atomically. The first word in a variable or in an allocated struct, array, or slice can be relied upon to be 64-bit aligned.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;æ¯”å¦‚ï¼Œä¸‹é¢è¿™æ®µä»£ç ï¼š&lt;/p&gt;

&lt;div class=&quot;language-go highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;package&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
	&lt;span class=&quot;s&quot;&gt;&quot;sync/atomic&quot;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;T3&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int64&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int32&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;d&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int64&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;T3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{}&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;atomic&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AddInt64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;d&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ç¼–è¯‘ä¸º 64bit å¯æ‰§è¡Œæ–‡ä»¶ï¼Œè¿è¡Œæ²¡æœ‰ä»»ä½•é—®é¢˜ï¼›ä½†æ˜¯å½“ç¼–è¯‘ä¸º 32bit å¯æ‰§è¡Œæ–‡ä»¶ï¼Œè¿è¡Œå°±ä¼š panic:&lt;/p&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ GOARCH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;386 go build aligned.go
&lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;./aligned
panic: runtime error: invalid memory address or nil pointer dereference
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;signal SIGSEGV: segmentation violation &lt;span class=&quot;nv&quot;&gt;code&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0x1 &lt;span class=&quot;nv&quot;&gt;addr&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0x0 &lt;span class=&quot;nv&quot;&gt;pc&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0x8049f2c]

goroutine 1 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;running]:
runtime/internal/atomic.Xadd64&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0x941218c, 0x1, 0x0, 0x809a4c0, 0x944e070&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
	/usr/local/go/src/runtime/internal/atomic/asm_386.s:105 +0xc
main.main&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
	/root/gofourge/src/lab/archive/aligned.go:18 +0x42
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;åŸå› å°±æ˜¯ T3 åœ¨ 32bit å¹³å°ä¸Šæ˜¯ 4 å­—èŠ‚å¯¹é½ï¼Œè€Œåœ¨ 64bit å¹³å°ä¸Šæ˜¯ 8 å­—èŠ‚å¯¹é½ã€‚åœ¨ 64bit å¹³å°ä¸Šå…¶å†…å­˜å¸ƒå±€ä¸ºï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/in-post/memory-alignment/T3-x86_64.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å¯ä»¥çœ‹åˆ°ç¼–è¯‘å™¨ä¸ºäº†è®© d 8 å­—èŠ‚å¯¹é½ï¼Œåœ¨ c åé¢ padding äº† 4 ä¸ªå­—èŠ‚ã€‚è€Œåœ¨ 32bit å¹³å°ä¸Šå…¶å†…å­˜å¸ƒå±€ä¸ºï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/in-post/memory-alignment/T3-x86.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ç¼–è¯‘å™¨ç”¨çš„æ˜¯ 4 å­—èŠ‚å¯¹é½ï¼Œæ‰€ä»¥ c åé¢ 4 ä¸ªå­—èŠ‚å¹¶æ²¡æœ‰ paddingï¼Œè€Œæ˜¯ç›´æ¥æ’åˆ— d çš„é«˜ä½ä½å­—èŠ‚ã€‚&lt;/p&gt;

&lt;p&gt;ä¸ºäº†è§£å†³è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¿…é¡»æ‰‹åŠ¨ padding T3ï¼Œè®©å…¶ â€œçœ‹èµ·æ¥â€ åƒæ˜¯ 8 å­—èŠ‚å¯¹é½çš„ï¼š&lt;/p&gt;

&lt;div class=&quot;language-go highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;T3&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int64&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int32&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int32&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;d&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int64&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;è¿™æ · T3 çš„å†…å­˜å¸ƒå±€å°±å˜æˆäº†ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/in-post/memory-alignment/T3-x86-8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;çœ‹èµ·æ¥å°±åƒ 8 å­—èŠ‚å¯¹é½äº†ä¸€æ ·ï¼Œè¿™æ ·å°±èƒ½å®Œç¾å…¼å®¹ 32bit å¹³å°äº†ã€‚å…¶å®å¾ˆå¤šçŸ¥åçš„é¡¹ç›®ï¼Œéƒ½æ˜¯è¿™ä¹ˆå¤„ç†çš„ï¼Œæ¯”å¦‚ &lt;a href=&quot;https://github.com/golang/groupcache/blob/869f871628b6baa9cfbc11732cdf6546b17c1298/groupcache.go#L169-L172&quot;&gt;groupcache&lt;/a&gt;ï¼š&lt;/p&gt;

&lt;div class=&quot;language-go highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Group&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int32&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;// force Stats to be 8-byte aligned on 32-bit platforms&lt;/span&gt;

	&lt;span class=&quot;c&quot;&gt;// Stats are statistics on the group.&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;Stats&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Stats&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;è¯´äº†è¿™ä¹ˆå¤šï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬å®é™…ç¼–ç çš„æ—¶å€™ï¼Œå¤šæ•°æƒ…å†µéƒ½ä¸ä¼šè€ƒè™‘åˆ°æœ€ä¼˜çš„å†…å­˜å¯¹é½ã€‚é‚£æœ‰æ²¡æœ‰ä»€ä¹ˆåŠæ³•èƒ½è‡ªåŠ¨æ£€æµ‹å½“å‰çš„å†…å­˜å¸ƒå±€æ˜¯æœ€ä¼˜å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼šæœ‰çš„ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://golang-sizeof.tips/&quot;&gt;golang-sizeof.tips&lt;/a&gt; è¿™ä¸ªç½‘ç«™å°±å¯ä»¥å¯è§†åŒ– struct çš„å†…å­˜å¸ƒå±€ï¼Œä½†æ˜¯åªæ”¯æŒ 8 å­—èŠ‚å¯¹é½ï¼Œæ˜¯ä¸ªç¼ºç‚¹ã€‚è¿˜æœ‰ä¸€ç§æ–¹æ³•ï¼Œå°±æ˜¯ç”¨ golangci-lint åšé™æ€æ£€æµ‹ï¼Œæ¯”å¦‚åœ¨æˆ‘çš„ä¸€ä¸ªé¡¹ç›®ä¸­æ£€æµ‹ç»“æœæ˜¯è¿™æ ·çš„ï¼š&lt;/p&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;golangci-lint run &lt;span class=&quot;nt&quot;&gt;--disable-all&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-E&lt;/span&gt; maligned
config/config.go:79:11: struct of size 48 bytes could be of size 40 bytes &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;maligned&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;type &lt;/span&gt;SASL struct &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
          ^
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æç¤ºæœ‰ä¸€å¤„ struct å¯ä»¥ä¼˜åŒ–ï¼Œæ¥çœ‹ä¸€ä¸‹è¿™ä¸ª struct çš„å®šä¹‰ï¼š&lt;/p&gt;

&lt;div class=&quot;language-go highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SASL&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;Enable&lt;/span&gt;    &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;Username&lt;/span&gt;  &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;Password&lt;/span&gt;  &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;Handshake&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;é€šè¿‡ &lt;a href=&quot;http://golang-sizeof.tips/&quot;&gt;golang-sizeof.tips&lt;/a&gt; å¯¹æ¯”ï¼Œæ˜¾ç„¶å­—æ®µæŒ‰ç…§ä¸‹é¢è¿™æ ·æ’åºæ›´ä¸ºåˆç†ï¼š&lt;/p&gt;

&lt;div class=&quot;language-go highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SASL&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;Username&lt;/span&gt;  &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;Password&lt;/span&gt;  &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;Handshake&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;Enable&lt;/span&gt;    &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;å‚è€ƒæ–‡çŒ®&quot;&gt;å‚è€ƒæ–‡çŒ®&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://blog.chewxy.com/2016/07/25/on-the-memory-alignment-of-go-slice-values/&quot;&gt;On the memory alignment of Go slice values&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://go101.org/article/memory-layout.html&quot;&gt;Memory Layouts&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/golang/go/issues/11891&quot;&gt;cmd/vet: detect non-64-bit-aligned arguments to sync/atomic funcs&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://dave.cheney.net/2015/10/09/padding-is-hard&quot;&gt;Padding is hard&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://eddycjy.gitbook.io/golang/di-1-ke-za-tan/go-memory-align&quot;&gt;åœ¨ Go ä¸­æ°åˆ°å¥½å¤„çš„å†…å­˜å¯¹é½&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.flysnow.org/2017/07/02/go-in-action-unsafe-memory-layout.html&quot;&gt;Go unsafe åŒ…ä¹‹å†…å­˜å¸ƒå±€&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

</description>
        <pubDate>Thu, 01 Aug 2019 00:00:00 +0800</pubDate>
        <link>http://localhost:4000/2019/08/01/golang-memory-alignment/</link>
        <guid isPermaLink="true">http://localhost:4000/2019/08/01/golang-memory-alignment/</guid>
        
        <category>Golang</category>
        
        <category>Atomicity</category>
        
        
      </item>
    
  </channel>
</rss>
